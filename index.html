<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tr√≤ ch∆°i ƒê∆∞·ªùng v·ªÅ nh√†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(173,216,230,0.3); border-radius: 15px; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
        .game-info { display: flex; justify-content: space-between; background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .player-status { display: flex; flex-direction: column; gap: 10px; }
        .status-item { display: flex; align-items: center; gap: 8px; }
        .dice-container { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .dice { width: 80px; height: 80px; background: white; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; }
        .dice.rolling { animation: roll 0.5s infinite; }
        @keyframes roll { 
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .board { display: grid; grid-template-columns: repeat(12, 1fr); gap: 5px; background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .cell { aspect-ratio: 1; background: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; position: relative; border: 1px solid #e0e0e0; }
        .cell.start { background: #2ecc71; }
        .cell.end { background: #e74c3c; }
        .cell.railroad { background: #e67e22; }
        .cell.nem-chua { background: #ffeb3b; }
        .cell.sandal { background: #ff9800; }
        .cell.rau-ma { background: #4caf50; }
        .cell.dinh-nam { background: #8B4513; }
        .cell.thu-do { background: #e74c3c; }
        .cell.special-36 { background: #9c27b0; }
        .cell.player { background: #3498db; }
        .cell.red-zone { background: #ffcccc; } /* M√†u ƒë·ªè cho c√°c √¥ t·ª´ 100 tr·ªü ƒëi */
        .cell-number { position: absolute; top: 2px; left: 2px; font-size: 10px; }
        .cell-icon { font-size: 18px; }
        button { background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; }
        .victory-overlay, .wheel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; flex-direction: column; z-index: 100; }
        .victory-message { font-size: 48px; color: gold; margin-bottom: 30px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .wheel { width: 300px; height: 300px; border-radius: 50%; background: conic-gradient(#e67e22 0% 50%, #3498db 50% 100%); transition: transform 3s; }
        .message-box { background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin-bottom: 20px; width: 100%; }
        
        /* Ph·∫ßn ch√∫ th√≠ch */
        .legend { 
            background: rgba(255,255,255,0.7); 
            padding: 15px; 
            border-radius: 10px; 
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 14px;
        }
        .legend-icon { 
            font-size: 20px; 
            width: 30px; 
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tr√≤ ch∆°i ƒê∆∞·ªùng v·ªÅ nh√†</h1>
        
        <div class="message-box" id="message">Ch√†o m·ª´ng! Nh·∫•n "Tung x√∫c x·∫Øc" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>
        
        <div class="game-info">
            <div class="player-status">
                <div class="status-item">Nem chua: <span id="nem-chua-count">0</span></div>
                <div class="status-item">Hi·ªáu ·ª©ng d√©p: <span id="sandal-effect">Kh√¥ng</span></div>
                <div class="status-item">Hi·ªáu ·ª©ng ƒêinh N·∫°m: <span id="dinh-nam-effect">Kh√¥ng</span></div>
                <div class="status-item">Hi·ªáu ·ª©ng B√£o: <span id="storm-effect">Kh√¥ng</span></div>
            </div>
            <div class="dice-container">
                <div class="dice" id="dice">?</div>
                <button id="roll-button">Tung x√∫c x·∫Øc</button>
            </div>
            <div class="player-status">
                <div class="status-item">V·ªã tr√≠: <span id="player-position">1</span></div>
                <div class="status-item">B∆∞·ªõc ƒëi: <span id="steps">0</span></div>
                <div class="status-item">V√≤ng: <span id="round">1</span></div>
            </div>
        </div>
        
        <div class="board" id="board"></div>
        
        <!-- Ph·∫ßn ch√∫ th√≠ch -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-icon">üèÅ</div>
                <div>B·∫Øt ƒë·∫ßu</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üè†</div>
                <div>K·∫øt th√∫c</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üöÇ</div>
                <div>ƒê∆∞·ªùng t√†u - Quay l·∫°i ƒë∆∞·ªùng t√†u g·∫ßn nh·∫•t</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">ü•†</div>
                <div>Nem chua - Mi·ªÖn nhi·ªÖm ƒë∆∞·ªùng t√†u</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">ü©¥</div>
                <div>D√©p - Gi·∫£m m·ªôt n·ª≠a b∆∞·ªõc ƒëi</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üåø</div>
                <div>Rau m√° - Nh·∫£y qua ƒë∆∞·ªùng t√†u ho·∫∑c x2 ƒëi·ªÉm</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üë§</div>
                <div>ƒêinh N·∫°m - Ch·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üèôÔ∏è</div>
                <div>Th·ªß ƒë√¥ - Quay v√≤ng quay</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">‚ùì</div>
                <div>√î ƒë·∫∑c bi·ªát - Quay v√≤ng quay</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üëç</div>
                <div>V·ªã tr√≠ ng∆∞·ªùi ch∆°i</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="background: #ffcccc; border-radius: 3px;">100+</div>
                <div>V√πng b√£o</div>
            </div>
        </div>
    </div>

    <div class="victory-overlay" id="victory-overlay">
        <div class="victory-message">Ch√∫c m·ª´ng b·∫°n ƒë√£ chinh ph·ª•c Thanh H√≥a!</div>
        <button onclick="resetGame()">Ch∆°i l·∫°i</button>
    </div>

    <div class="wheel-overlay" id="wheel-overlay">
        <div class="wheel" id="wheel"></div>
        <div class="wheel-result" id="wheel-result"></div>
        <button onclick="closeWheel()">Ti·∫øp t·ª•c</button>
    </div>

    <script>
        let playerPosition = 0, nemChuaCount = 0, sandalEffect = false, dinhNamEffect = false, doubleEffect = false, stormEffect = false;
        let round = 1, isRolling = false, hasVisited36 = false, hasVisitedThuDo = false;
        const TOTAL_CELLS = 136;
        const cellOriginalState = new Map();

        function createBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for (let i = 0; i < TOTAL_CELLS; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                
                // Th√™m l·ªõp red-zone cho c√°c √¥ t·ª´ 100 tr·ªü ƒëi
                if (i >= 99) {
                    cell.classList.add('red-zone');
                }
                
                const cellNumber = document.createElement('div');
                cellNumber.className = 'cell-number';
                cellNumber.textContent = i + 1;
                cell.appendChild(cellNumber);
                if (i === 0) {
                    cell.classList.add('start');
                    const icon = document.createElement('div');
                    icon.className = 'cell-icon';
                    icon.textContent = 'üèÅ';
                    cell.appendChild(icon);
                } else if (i === TOTAL_CELLS - 1) {
                    cell.classList.add('end');
                    const icon = document.createElement('div');
                    icon.className = 'cell-icon';
                    icon.textContent = 'üè†';
                    cell.appendChild(icon);
                }
                board.appendChild(cell);
            }

            for (let i = 15; i < TOTAL_CELLS - 30; i += 15) {
                const cell = document.getElementById(`cell-${i}`);
                cell.classList.add('railroad');
                const icon = document.createElement('div');
                icon.className = 'cell-icon';
                icon.textContent = 'üöÇ';
                cell.appendChild(icon);
                cellOriginalState.set(i, {classes: ['railroad'], icon: 'üöÇ'});
            }

            const usedPositions = new Set();
            addItems('nem-chua', 'ü•†', 15, usedPositions);
            addItems('sandal', 'ü©¥', 20, usedPositions);
            addItems('rau-ma', 'üåø', 15, usedPositions);

            const cell18 = document.getElementById('cell-17');
            cell18.classList.add('dinh-nam');
            const icon18 = document.createElement('div');
            icon18.className = 'cell-icon';
            icon18.textContent = 'üë§';
            cell18.appendChild(icon18);
            cellOriginalState.set(17, {classes: ['dinh-nam'], icon: 'üë§'});

            const cell29 = document.getElementById('cell-28');
            cell29.classList.add('thu-do');
            const icon29 = document.createElement('div');
            icon29.className = 'cell-icon';
            icon29.textContent = 'üèôÔ∏è';
            cell29.appendChild(icon29);
            cellOriginalState.set(28, {classes: ['thu-do'], icon: 'üèôÔ∏è'});

            const cell30 = document.getElementById('cell-29');
            cell30.classList.add('thu-do');
            const icon30 = document.createElement('div');
            icon30.className = 'cell-icon';
            icon30.textContent = 'üèôÔ∏è';
            cell30.appendChild(icon30);
            cellOriginalState.set(29, {classes: ['thu-do'], icon: 'üèôÔ∏è'});

            const cell36 = document.getElementById('cell-35');
            cell36.classList.add('special-36');
            const icon36 = document.createElement('div');
            icon36.className = 'cell-icon';
            icon36.textContent = '‚ùì';
            cell36.appendChild(icon36);
            cellOriginalState.set(35, {classes: ['special-36'], icon: '‚ùì'});

            updatePlayerPosition();
        }

        function addItems(className, icon, count, usedPositions) {
            let added = 0;
            while (added < count) {
                const randomPos = Math.floor(Math.random() * (TOTAL_CELLS - 2)) + 1;
                if (!usedPositions.has(randomPos) && randomPos !== 17 && randomPos !== 28 && randomPos !== 29 && randomPos !== 35 && !document.getElementById(`cell-${randomPos}`).classList.contains('railroad')) {
                    const cell = document.getElementById(`cell-${randomPos}`);
                    cell.classList.add(className);
                    const itemIcon = document.createElement('div');
                    itemIcon.className = 'cell-icon';
                    itemIcon.textContent = icon;
                    cell.appendChild(itemIcon);
                    cellOriginalState.set(randomPos, {classes: [className], icon: icon});
                    usedPositions.add(randomPos);
                    added++;
                }
            }
        }

        function updatePlayerPosition() {
            document.querySelectorAll('.cell.player').forEach(cell => {
                const cellId = parseInt(cell.id.split('-')[1]);
                cell.classList.remove('player');
                if (cellOriginalState.has(cellId)) {
                    const original = cellOriginalState.get(cellId);
                    cell.className = 'cell';
                    original.classes.forEach(cls => cell.classList.add(cls));
                    // Gi·ªØ l·∫°i l·ªõp red-zone n·∫øu √¥ t·ª´ 100 tr·ªü ƒëi
                    if (cellId >= 99) {
                        cell.classList.add('red-zone');
                    }
                    const icons = cell.querySelectorAll('.cell-icon');
                    icons.forEach(icon => icon.remove());
                    const newIcon = document.createElement('div');
                    newIcon.className = 'cell-icon';
                    newIcon.textContent = original.icon;
                    cell.appendChild(newIcon);
                } else {
                    const icons = cell.querySelectorAll('.cell-icon');
                    icons.forEach(icon => { if (icon.textContent === 'üëç') icon.remove(); });
                }
            });

            const currentCell = document.getElementById(`cell-${playerPosition}`);
            if (currentCell) {
                currentCell.classList.add('player');
                if (!cellOriginalState.has(playerPosition)) {
                    const currentClasses = Array.from(currentCell.classList).filter(cls => cls !== 'cell' && cls !== 'player' && cls !== 'red-zone');
                    const currentIcon = currentCell.querySelector('.cell-icon')?.textContent || '';
                    cellOriginalState.set(playerPosition, {classes: currentClasses, icon: currentIcon});
                }
                const icons = currentCell.querySelectorAll('.cell-icon');
                icons.forEach(icon => icon.remove());
                const playerIcon = document.createElement('div');
                playerIcon.className = 'cell-icon';
                playerIcon.textContent = 'üëç';
                currentCell.appendChild(playerIcon);
            }
            document.getElementById('player-position').textContent = playerPosition + 1;
        }

        function rollDice() {
            if (isRolling) return;
            isRolling = true;
            const dice = document.getElementById('dice');
            const rollButton = document.getElementById('roll-button');
            const message = document.getElementById('message');
            dice.textContent = '?';
            dice.classList.add('rolling');
            rollButton.disabled = true;

            setTimeout(() => {
                let diceValue = Math.floor(Math.random() * 6) + 1;
                let originalValue = diceValue;

                if (dinhNamEffect) {
                    diceValue = 1;
                    message.textContent = "Hi·ªáu ·ª©ng ƒêinh N·∫°m! B·∫°n ch·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm.";
                    dinhNamEffect = false;
                    document.getElementById('dinh-nam-effect').textContent = 'Kh√¥ng';
                } else if (sandalEffect) {
                    diceValue = Math.floor(diceValue / 2);
                    message.textContent = `Hi·ªáu ·ª©ng d√©p! B·∫°n ch·ªâ ƒëi ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc thay v√¨ ${originalValue}.`;
                    sandalEffect = false;
                    document.getElementById('sandal-effect').textContent = 'Kh√¥ng';
                } else if (stormEffect && playerPosition >= 99) {
                    diceValue = Math.floor(diceValue / 2);
                    message.textContent = `B√£o Xu√¢n Quang! B·∫°n ch·ªâ ƒëi ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc thay v√¨ ${originalValue}.`;
                } else if (doubleEffect) {
                    diceValue = diceValue * 2;
                    message.textContent = `Hi·ªáu ·ª©ng Rau m√°! B·∫°n ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc!`;
                    doubleEffect = false;
                } else {
                    message.textContent = `B·∫°n ƒë√£ tung ƒë∆∞·ª£c ${diceValue}!`;
                }

                dice.textContent = diceValue;
                dice.classList.remove('rolling');
                rollButton.disabled = false;
                isRolling = false;
                movePlayer(diceValue);
            }, 1000);
        }

        function movePlayer(stepsToMove) {
            document.getElementById('steps').textContent = stepsToMove;
            let newPosition = playerPosition + stepsToMove;

            if (!hasVisited36 && playerPosition <= 35 && newPosition >= 35) {
                hasVisited36 = true;
                setTimeout(showWheel, 500);
            }

            if (!hasVisitedThuDo && playerPosition <= 29 && newPosition >= 28) {
                hasVisitedThuDo = true;
                setTimeout(showWheel, 500);
            }

            if (newPosition >= 99 && !stormEffect) {
                stormEffect = true;
                document.getElementById('storm-effect').textContent = 'C√≥';
                document.getElementById('message').textContent = "B√£o Xu√¢n Quang ƒë√£ ƒë·∫øn! M·ªçi ƒëi·ªÉm x√∫c x·∫Øc nh·∫≠n ƒë∆∞·ª£c s·∫Ω gi·∫£m 1/2.";
            }

            if (newPosition >= TOTAL_CELLS - 1) {
                newPosition = TOTAL_CELLS - 1;
                setTimeout(showVictory, 1000);
            }

            playerPosition = newPosition;
            updatePlayerPosition();
            setTimeout(checkSpecialCell, 100);
        }

        function checkSpecialCell() {
            const message = document.getElementById('message');
            const originalState = cellOriginalState.get(playerPosition);
            if (!originalState) return;

            if (originalState.classes.includes('railroad')) {
                if (nemChuaCount > 0) {
                    nemChuaCount--;
                    document.getElementById('nem-chua-count').textContent = nemChuaCount;
                    message.textContent = "B·∫°n ƒë√£ s·ª≠ d·ª•ng m·ªôt nem chua ƒë·ªÉ mi·ªÖn nhi·ªÖm v·ªõi ƒë∆∞·ªùng t√†u!";
                } else {
                    let nearestRailroad = 0;
                    for (let i = playerPosition - 1; i >= 0; i--) {
                        if (cellOriginalState.has(i) && cellOriginalState.get(i).classes.includes('railroad')) {
                            nearestRailroad = i;
                            break;
                        }
                    }
                    playerPosition = nearestRailroad;
                    updatePlayerPosition();
                    message.textContent = `√îi kh√¥ng! B·∫°n v·∫•p ph·∫£i ƒë∆∞·ªùng t√†u v√† ph·∫£i quay l·∫°i √¥ ${playerPosition + 1}!`;
                }
            }

            if (originalState.classes.includes('nem-chua') && nemChuaCount < 1) {
                nemChuaCount = 1;
                document.getElementById('nem-chua-count').textContent = nemChuaCount;
                message.textContent = "Tuy·ªát v·ªùi! B·∫°n nh·∫≠n ƒë∆∞·ª£c m·ªôt nem chua!";
            }

            if (originalState.classes.includes('sandal')) {
                sandalEffect = true;
                document.getElementById('sandal-effect').textContent = 'C√≥';
                message.textContent = "√îi kh√¥ng! B·∫°n b·ªã m·∫•t d√©p!";
            }

            if (originalState.classes.includes('rau-ma')) {
                if (playerPosition >= 99) {
                    doubleEffect = true;
                    message.textContent = "Tuy·ªát v·ªùi! B·∫°n nh·∫≠n ƒë∆∞·ª£c rau m√° v√† ƒë∆∞·ª£c x2 ƒëi·ªÉm!";
                } else {
                    let nextRailroad = -1;
                    for (let i = playerPosition + 1; i < TOTAL_CELLS; i++) {
                        if (cellOriginalState.has(i) && cellOriginalState.get(i).classes.includes('railroad')) {
                            nextRailroad = i;
                            break;
                        }
                    }
                    if (nextRailroad !== -1) {
                        playerPosition = nextRailroad + 1;
                        updatePlayerPosition();
                        message.textContent = `Rau m√° gi√∫p b·∫°n d·ªãch chuy·ªÉn ƒë·∫øn sau ƒë∆∞·ªùng t√†u!`;
                    }
                }
            }

            if (originalState.classes.includes('dinh-nam')) {
                dinhNamEffect = true;
                document.getElementById('dinh-nam-effect').textContent = 'C√≥';
                message.textContent = "B·∫°n ƒë√£ ch·∫°m ch√°n m·ªôt t√™n ƒêinh N·∫°m!";
            }

            round++;
            document.getElementById('round').textContent = round;
        }

        function showWheel() {
            const wheelOverlay = document.getElementById('wheel-overlay');
            const wheel = document.getElementById('wheel');
            const wheelResult = document.getElementById('wheel-result');
            wheelOverlay.style.display = 'flex';
            wheelResult.textContent = '';
            const spinDegrees = 1080 + Math.floor(Math.random() * 360);
            wheel.style.transform = `rotate(${spinDegrees}deg)`;

            setTimeout(() => {
                const normalizedDegrees = spinDegrees % 360;
                let result = '';
                if (normalizedDegrees < 180) {
                    result = 'V·ªÅ ƒë∆∞·ªùng t√†u g·∫ßn nh·∫•t ph√≠a sau';
                    let nearestRailroad = 0;
                    for (let i = playerPosition - 1; i >= 0; i--) {
                        if (cellOriginalState.has(i) && cellOriginalState.get(i).classes.includes('railroad')) {
                            nearestRailroad = i;
                            break;
                        }
                    }
                    playerPosition = nearestRailroad;
                    updatePlayerPosition();
                } else {
                    result = 'X2 X√∫c x·∫Øc';
                    doubleEffect = true;
                }
                wheelResult.textContent = `K·∫øt qu·∫£: ${result}`;
            }, 3000);
        }

        function closeWheel() {
            document.getElementById('wheel-overlay').style.display = 'none';
        }

        function showVictory() {
            document.getElementById('victory-overlay').style.display = 'flex';
            document.getElementById('roll-button').disabled = true;
        }

        function resetGame() {
            playerPosition = 0;
            nemChuaCount = 0;
            sandalEffect = false;
            dinhNamEffect = false;
            doubleEffect = false;
            stormEffect = false;
            round = 1;
            hasVisited36 = false;
            hasVisitedThuDo = false;
            document.getElementById('nem-chua-count').textContent = nemChuaCount;
            document.getElementById('sandal-effect').textContent = 'Kh√¥ng';
            document.getElementById('dinh-nam-effect').textContent = 'Kh√¥ng';
            document.getElementById('storm-effect').textContent = 'Kh√¥ng';
            document.getElementById('player-position').textContent = playerPosition + 1;
            document.getElementById('steps').textContent = 0;
            document.getElementById('round').textContent = round;
            document.getElementById('message').textContent = 'Tr√≤ ch∆°i ƒë√£ ƒë∆∞·ª£c reset!';
            document.getElementById('victory-overlay').style.display = 'none';
            document.getElementById('roll-button').disabled = false;
            createBoard();
        }

        function initGame() {
            createBoard();
            document.getElementById('roll-button').addEventListener('click', rollDice);
            document.getElementById('dice').addEventListener('click', rollDice);
        }

        window.onload = initGame;
    </script>
</body>
</html>
