<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="Tr√≤ ch∆°i ƒê∆∞·ªùng v·ªÅ nh√† - H√†nh tr√¨nh chinh ph·ª•c Thanh H√≥a">
    <title>ƒê∆∞·ªùng v·ªÅ nh√†</title>
    <link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:&quot;ƒê∆∞·ªùng v·ªÅ nh√†&quot;,&quot;short_name&quot;:&quot;ƒê∆∞·ªùngV·ªÅNh√†&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#a8edea&quot;,&quot;theme_color&quot;:&quot;#3498db&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%233498db'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>üè†</text></svg>&quot;,&quot;sizes&quot;:&quot;100x100&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%233498db'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>üè†</text></svg>">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body { 
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); 
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }
        
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            background: rgba(173,216,230,0.3); 
            border-radius: 15px; 
            padding: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 { 
            text-align: center; 
            margin-bottom: 15px; 
            color: #2c3e50; 
            font-size: 1.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .game-info { 
            display: flex; 
            flex-direction: column;
            gap: 15px;
            background: rgba(255,255,255,0.7); 
            padding: 12px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
        }
        
        .player-status { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            flex: 1;
        }
        
        .status-item { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            font-size: 0.9rem;
        }
        
        .dice-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 12px; 
            margin: 10px 0;
        }
        
        .dice { 
            width: 70px; 
            height: 70px; 
            background: white; 
            border-radius: 15px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 32px; 
            cursor: pointer; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            user-select: none;
        }
        
        .dice.rolling { 
            animation: roll 0.5s infinite; 
        }
        
        @keyframes roll { 
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .board { 
            display: grid; 
            grid-template-columns: repeat(10, 1fr); 
            gap: 4px; 
            background: rgba(255,255,255,0.7); 
            padding: 12px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            overflow: auto;
            max-width: 100%;
        }
        
        .cell { 
            aspect-ratio: 1; 
            background: white; 
            border-radius: 5px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            border: 1px solid #e0e0e0; 
            font-size: 0.7rem;
            min-width: 0;
        }
        
        .cell.start { background: #2ecc71; }
        .cell.end { background: #e74c3c; }
        .cell.railroad { background: #e67e22; }
        .cell.nem-chua { background: #ffeb3b; }
        .cell.shoes { background: #ff9800; }
        .cell.rau-ma { background: #4caf50; }
        .cell.dinh-nam { background: #8B4513; }
        .cell.thu-do { background: #e74c3c; }
        .cell.special-36 { background: #9c27b0; }
        .cell.player { background: #3498db; }
        .cell.red-zone { background: #ffcccc; }
        .cell.push-back { background: #ff6b6b; }
        
        .cell-number { 
            position: absolute; 
            top: 1px; 
            left: 2px; 
            font-size: 8px; 
            font-weight: bold;
        }
        
        .cell-icon { 
            font-size: 14px; 
        }
        
        button { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            transition: all 0.2s;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
            display: block;
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .victory-overlay, .wheel-overlay, .tutorial-overlay, .effect-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.85); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            z-index: 100; 
            padding: 20px;
            text-align: center;
        }
        
        .victory-message { 
            font-size: 2rem; 
            color: gold; 
            margin-bottom: 20px; 
            animation: pulse 1.5s infinite; 
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        .effect-message {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 20px;
            animation: pulse 1s infinite;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            padding: 20px;
            border-radius: 15px;
            background: rgba(0,0,0,0.7);
        }
        
        @keyframes pulse { 
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .wheel { 
            width: 250px; 
            height: 250px; 
            border-radius: 50%; 
            background: conic-gradient(#e67e22 0% 33%, #3498db 33% 66%, #2ecc71 66% 100%); 
            transition: transform 3s; 
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
        
        .message-box { 
            background: rgba(255,255,255,0.7); 
            padding: 12px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            width: 100%; 
            font-size: 0.9rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .legend { 
            background: rgba(255,255,255,0.7); 
            padding: 12px; 
            border-radius: 10px; 
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 0.8rem;
        }
        
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
        }
        
        .legend-icon { 
            font-size: 16px; 
            width: 24px; 
            text-align: center;
        }
        
        .tutorial-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .tutorial-content h2 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .tutorial-content p {
            margin-bottom: 10px;
            text-align: left;
        }
        
        .tutorial-content ul {
            margin-left: 20px;
            text-align: left;
            margin-bottom: 15px;
        }
        
        .install-btn {
            background: #2ecc71;
            margin-top: 10px;
        }
        
        @media (min-width: 768px) {
            .board {
                grid-template-columns: repeat(12, 1fr);
            }
            
            .game-info {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .status-row {
                flex-direction: column;
                width: 30%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .legend {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 380px) {
            .board {
                grid-template-columns: repeat(8, 1fr);
            }
            
            .legend {
                grid-template-columns: 1fr;
            }
        }
        
        /* Th√™m hi·ªáu ·ª©ng loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <h2>ƒêang t·∫£i tr√≤ ch∆°i...</h2>
    </div>

    <div class="container" style="display: none;" id="game-container">
        <h1>ƒê∆∞·ªùng v·ªÅ nh√† üè†</h1>
        
        <div class="message-box" id="message">Ch√†o m·ª´ng! Nh·∫•n "B·∫Øt ƒë·∫ßu" ƒë·ªÉ xem h∆∞·ªõng d·∫´n.</div>
        
        <div class="game-info">
            <div class="status-row">
                <div class="player-status">
                    <div class="status-item">Nem chua: <span id="nem-chua-count">0</span></div>
                    <div class="status-item">Hi·ªáu ·ª©ng gi√†y: <span id="shoes-effect">Kh√¥ng</span></div>
                </div>
            </div>
            
            <div class="dice-container">
                <div class="dice" id="dice">?</div>
                <button id="roll-button">B·∫Øt ƒë·∫ßu</button>
                <button class="install-btn" id="install-btn" style="display: none;">C√†i ƒë·∫∑t App</button>
            </div>
            
            <div class="status-row">
                <div class="player-status">
                    <div class="status-item">V·ªã tr√≠: <span id="player-position">1</span></div>
                    <div class="status-item">B∆∞·ªõc ƒëi: <span id="steps">0</span></div>
                    <div class="status-item">V√≤ng: <span id="round">1</span></div>
                </div>
            </div>
        </div>
        
        <div class="board" id="board"></div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-icon">üèÅ</div>
                <div>B·∫Øt ƒë·∫ßu</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üè†</div>
                <div>K·∫øt th√∫c</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üöÇ</div>
                <div>ƒê∆∞·ªùng t√†u</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">ü•†</div>
                <div>Nem chua</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üëü</div>
                <div>Gi√†y</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üåø</div>
                <div>Rau m√°</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üë§</div>
                <div>ƒêinh N·∫°m</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üèôÔ∏è</div>
                <div>Th·ªß ƒë√¥</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">‚ùì</div>
                <div>√î ƒë·∫∑c bi·ªát</div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üö∂</div>
                <div>Ng∆∞·ªùi ch∆°i</div>
            </div>
        </div>
    </div>

    <div class="victory-overlay" id="victory-overlay">
        <div class="victory-message">Ch√∫c m·ª´ng b·∫°n ƒë√£ chinh ph·ª•c Thanh H√≥a!</div>
        <button onclick="resetGame()">Ch∆°i l·∫°i</button>
    </div>

    <div class="wheel-overlay" id="wheel-overlay">
        <div class="wheel" id="wheel"></div>
        <div class="wheel-result" id="wheel-result" style="color: white; margin: 15px 0; font-size: 1.2rem;"></div>
        <button onclick="closeWheel()">Ti·∫øp t·ª•c</button>
    </div>

    <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-content">
            <h2>H∆∞·ªõng d·∫´n ch∆°i</h2>
            <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi tr√≤ ch∆°i ƒê∆∞·ªùng v·ªÅ nh√†! D∆∞·ªõi ƒë√¢y l√† h∆∞·ªõng d·∫´n c√°ch ch∆°i:</p>
            <ul>
                <li>Nh·∫•n n√∫t "Tung x√∫c x·∫Øc" ƒë·ªÉ di chuy·ªÉn</li>
                <li>M·ª•c ti√™u: ƒê·∫øn √¥ cu·ªëi c√πng (√¥ 136)</li>
                <li>Nem chua: B·∫£o v·ªá b·∫°n kh·ªèi ƒë∆∞·ªùng t√†u (ch·ªâ c√≥ trong 100 √¥ ƒë·∫ßu)</li>
                <li>Gi√†y: L√†m gi·∫£m s·ªë b∆∞·ªõc ƒëi (1‚Üí1, 2‚Üí1, 3‚Üí2, 4‚Üí2, 5‚Üí2, 6‚Üí3)</li>
                <li>Rau m√°: Nh√¢n ƒë√¥i s·ªë ƒëi·ªÉm x√∫c x·∫Øc</li>
                <li>ƒêinh N·∫°m: B·∫°n ch·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm</li>
                <li>Th·ªß ƒë√¥ (√¥ 29, 30): M·∫•t 1 nem chua</li>
                <li>√î ƒë·∫∑c bi·ªát (√¥ 36): Nh·∫≠n hi·ªáu ·ª©ng ng·∫´u nhi√™n</li>
                <li>T·ª´ √¥ 100: C√≥ b√£o v√† √¥ ƒë·∫©y l√πi</li>
            </ul>
            <p>Ch√∫c b·∫°n ch∆°i vui v·∫ª!</p>
            <button onclick="closeTutorial()">B·∫Øt ƒë·∫ßu ch∆°i</button>
        </div>
    </div>

    <div class="effect-overlay" id="effect-overlay">
        <div class="effect-message" id="effect-message"></div>
    </div>

    <script>
        // ·∫®n loading screen sau khi t·∫£i xong
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game-container').style.display = 'block';
            }, 1000);
        });

        // Bi·∫øn to√†n c·ª•c
        let playerPosition = 0, nemChuaCount = 0, shoesEffect = false, dinhNamEffect = false, doubleEffect = false, stormEffect = false;
        let round = 1, isRolling = false, hasVisited36 = false, hasVisitedThuDo = false;
        const TOTAL_CELLS = 136;
        const cellOriginalState = new Map();
        let gameStarted = false;
        let deferredPrompt;

        // T·∫°o b√†n ch∆°i
        function createBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for (let i = 0; i < TOTAL_CELLS; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                
                // Th√™m l·ªõp red-zone cho c√°c √¥ t·ª´ 100 tr·ªü ƒëi
                if (i >= 99) {
                    cell.classList.add('red-zone');
                }
                
                const cellNumber = document.createElement('div');
                cellNumber.className = 'cell-number';
                cellNumber.textContent = i + 1;
                cell.appendChild(cellNumber);
                if (i === 0) {
                    cell.classList.add('start');
                    const icon = document.createElement('div');
                    icon.className = 'cell-icon';
                    icon.textContent = 'üèÅ';
                    cell.appendChild(icon);
                } else if (i === TOTAL_CELLS - 1) {
                    cell.classList.add('end');
                    const icon = document.createElement('div');
                    icon.className = 'cell-icon';
                    icon.textContent = 'üè†';
                    cell.appendChild(icon);
                }
                board.appendChild(cell);
            }

            // Th√™m ƒë∆∞·ªùng t√†u ·ªü c√°c v·ªã tr√≠ m·ªõi
            const railroadPositions = [20, 44, 69, 97];
            railroadPositions.forEach(pos => {
                const cell = document.getElementById(`cell-${pos}`);
                cell.classList.add('railroad');
                const icon = document.createElement('div');
                icon.className = 'cell-icon';
                icon.textContent = 'üöÇ';
                cell.appendChild(icon);
                cellOriginalState.set(pos, {classes: ['railroad'], icon: 'üöÇ'});
            });

            // Th√™m v·∫≠t ph·∫©m v·ªõi s·ªë l∆∞·ª£ng gi·ªõi h·∫°n trong m·ªói 15 √¥
            const usedPositions = new Set();
            
            // Th√™m v·∫≠t ph·∫©m cho 100 √¥ ƒë·∫ßu
            for (let segment = 0; segment < 100; segment += 15) {
                const segmentEnd = Math.min(segment + 15, 100);
                addItemsInSegment('nem-chua', 'ü•†', 2, segment, segmentEnd, usedPositions);
                addItemsInSegment('rau-ma', 'üåø', 3, segment, segmentEnd, usedPositions);
                addItemsInSegment('shoes', 'üëü', 4, segment, segmentEnd, usedPositions);
            }
            
            // Th√™m rau m√° cho c√°c √¥ t·ª´ 100 tr·ªü ƒëi (3 rau m√° c√°ch nhau 4 √¥ t·ªëi thi·ªÉu)
            addRauMaAfter100();

            // Th√™m c√°c √¥ ƒë·∫∑c bi·ªát
            const specialCells = [
                {id: 17, class: 'dinh-nam', icon: 'üë§'},
                {id: 28, class: 'thu-do', icon: 'üèôÔ∏è'},
                {id: 29, class: 'thu-do', icon: 'üèôÔ∏è'},
                {id: 35, class: 'special-36', icon: '‚ùì'}
            ];

            specialCells.forEach(cellInfo => {
                const cell = document.getElementById(`cell-${cellInfo.id}`);
                cell.classList.add(cellInfo.class);
                const icon = document.createElement('div');
                icon.className = 'cell-icon';
                icon.textContent = cellInfo.icon;
                cell.appendChild(icon);
                cellOriginalState.set(cellInfo.id, {classes: [cellInfo.class], icon: cellInfo.icon});
            });

            // Th√™m √¥ ƒë·∫©y l√πi (t·ª´ 118-122)
            const pushBackPos = Math.floor(Math.random() * 5) + 118;
            const pushBackCell = document.getElementById(`cell-${pushBackPos}`);
            pushBackCell.classList.add('push-back');
            const pushBackIcon = document.createElement('div');
            pushBackIcon.className = 'cell-icon';
            pushBackIcon.textContent = '‚Ü©Ô∏è';
            pushBackCell.appendChild(pushBackIcon);
            cellOriginalState.set(pushBackPos, {classes: ['push-back'], icon: '‚Ü©Ô∏è'});

            updatePlayerPosition();
        }

        // Th√™m v·∫≠t ph·∫©m trong m·ªôt ƒëo·∫°n √¥
        function addItemsInSegment(className, icon, count, startPos, endPos, usedPositions) {
            let added = 0;
            
            while (added < count) {
                const randomPos = Math.floor(Math.random() * (endPos - startPos)) + startPos;
                if (!usedPositions.has(randomPos) && 
                    randomPos !== 0 && 
                    randomPos !== TOTAL_CELLS - 1 &&
                    randomPos !== 17 && 
                    randomPos !== 28 && 
                    randomPos !== 29 && 
                    randomPos !== 35 &&
                    !document.getElementById(`cell-${randomPos}`).classList.contains('railroad') &&
                    !document.getElementById(`cell-${randomPos}`).classList.contains('push-back')) {
                    
                    const cell = document.getElementById(`cell-${randomPos}`);
                    cell.classList.add(className);
                    const itemIcon = document.createElement('div');
                    itemIcon.className = 'cell-icon';
                    itemIcon.textContent = icon;
                    cell.appendChild(itemIcon);
                    cellOriginalState.set(randomPos, {classes: [className], icon: icon});
                    usedPositions.add(randomPos);
                    added++;
                }
            }
        }

        // Th√™m rau m√° sau √¥ 100 v·ªõi kho·∫£ng c√°ch t·ªëi thi·ªÉu 4 √¥
        function addRauMaAfter100() {
            const usedPositions = new Set();
            let added = 0;
            let lastRauMaPos = 99;
            
            while (added < 3) {
                const randomPos = Math.floor(Math.random() * 36) + 100;
                
                if (randomPos - lastRauMaPos >= 4 && 
                    !usedPositions.has(randomPos) &&
                    randomPos !== TOTAL_CELLS - 1 &&
                    !document.getElementById(`cell-${randomPos}`).classList.contains('railroad') &&
                    !document.getElementById(`cell-${randomPos}`).classList.contains('push-back')) {
                    
                    const cell = document.getElementById(`cell-${randomPos}`);
                    cell.classList.add('rau-ma');
                    const itemIcon = document.createElement('div');
                    itemIcon.className = 'cell-icon';
                    itemIcon.textContent = 'üåø';
                    cell.appendChild(itemIcon);
                    cellOriginalState.set(randomPos, {classes: ['rau-ma'], icon: 'üåø'});
                    usedPositions.add(randomPos);
                    lastRauMaPos = randomPos;
                    added++;
                }
            }
        }

        // C·∫≠p nh·∫≠t v·ªã tr√≠ ng∆∞·ªùi ch∆°i
        function updatePlayerPosition() {
            document.querySelectorAll('.cell.player').forEach(cell => {
                const cellId = parseInt(cell.id.split('-')[1]);
                cell.classList.remove('player');
                if (cellOriginalState.has(cellId)) {
                    const original = cellOriginalState.get(cellId);
                    cell.className = 'cell';
                    original.classes.forEach(cls => cell.classList.add(cls));
                    if (cellId >= 99) {
                        cell.classList.add('red-zone');
                    }
                    const icons = cell.querySelectorAll('.cell-icon');
                    icons.forEach(icon => icon.remove());
                    const newIcon = document.createElement('div');
                    newIcon.className = 'cell-icon';
                    newIcon.textContent = original.icon;
                    cell.appendChild(newIcon);
                } else {
                    const icons = cell.querySelectorAll('.cell-icon');
                    icons.forEach(icon => { if (icon.textContent === 'üö∂') icon.remove(); });
                }
            });

            const currentCell = document.getElementById(`cell-${playerPosition}`);
            if (currentCell) {
                currentCell.classList.add('player');
                if (!cellOriginalState.has(playerPosition)) {
                    const currentClasses = Array.from(currentCell.classList).filter(cls => cls !== 'cell' && cls !== 'player' && cls !== 'red-zone');
                    const currentIcon = currentCell.querySelector('.cell-icon')?.textContent || '';
                    cellOriginalState.set(playerPosition, {classes: currentClasses, icon: currentIcon});
                }
                const icons = currentCell.querySelectorAll('.cell-icon');
                icons.forEach(icon => icon.remove());
                const playerIcon = document.createElement('div');
                playerIcon.className = 'cell-icon';
                playerIcon.textContent = 'üö∂';
                currentCell.appendChild(playerIcon);
            }
            document.getElementById('player-position').textContent = playerPosition + 1;
        }

        // Hi·ªÉn th·ªã hi·ªáu ·ª©ng
        function showEffect(message) {
            const effectOverlay = document.getElementById('effect-overlay');
            const effectMessage = document.getElementById('effect-message');
            effectMessage.textContent = message;
            effectOverlay.style.display = 'flex';
            
            setTimeout(() => {
                effectOverlay.style.display = 'none';
            }, 2000);
            
            effectOverlay.addEventListener('click', () => {
                effectOverlay.style.display = 'none';
            });
        }

        // T√≠nh to√°n gi√° tr·ªã x√∫c x·∫Øc sau khi √°p d·ª•ng hi·ªáu ·ª©ng gi√†y
        function calculateShoesEffect(diceValue) {
            switch(diceValue) {
                case 1: return 1;
                case 2: return 1;
                case 3: return 2;
                case 4: return 2;
                case 5: return 2;
                case 6: return 3;
                default: return diceValue;
            }
        }

        // Tung x√∫c x·∫Øc
        function rollDice() {
            if (!gameStarted) {
                showTutorial();
                return;
            }
            
            if (isRolling) return;
            isRolling = true;
            const dice = document.getElementById('dice');
            const rollButton = document.getElementById('roll-button');
            const message = document.getElementById('message');
            dice.textContent = '?';
            dice.classList.add('rolling');
            rollButton.disabled = true;

            setTimeout(() => {
                let diceValue = Math.floor(Math.random() * 6) + 1;
                let originalValue = diceValue;

                if (dinhNamEffect) {
                    diceValue = 1;
                    message.textContent = "Hi·ªáu ·ª©ng ƒêinh N·∫°m! B·∫°n ch·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm.";
                    showEffect("ƒêINH N·∫†M!\nCh·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm");
                    dinhNamEffect = false;
                    document.getElementById('shoes-effect').textContent = 'Kh√¥ng';
                } else if (shoesEffect) {
                    diceValue = calculateShoesEffect(diceValue);
                    message.textContent = `Hi·ªáu ·ª©ng gi√†y! B·∫°n ch·ªâ ƒëi ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc thay v√¨ ${originalValue}.`;
                    showEffect("HI·ªÜU ·ª®NG GI√ÄY!\nGi·∫£m m·ªôt n·ª≠a ƒëi·ªÉm");
                    shoesEffect = false;
                    document.getElementById('shoes-effect').textContent = 'Kh√¥ng';
                } else if (stormEffect && playerPosition >= 99) {
                    diceValue = Math.floor(diceValue / 2);
                    message.textContent = `B√£o Xu√¢n Quang! B·∫°n ch·ªâ ƒëi ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc thay v√¨ ${originalValue}.`;
                    showEffect("B√ÉO XU√ÇN QUANG!\nGi·∫£m m·ªôt n·ª≠a ƒëi·ªÉm");
                } else if (doubleEffect) {
                    diceValue = diceValue * 2;
                    message.textContent = `Hi·ªáu ·ª©ng Rau m√°! B·∫°n ƒë∆∞·ª£c ${diceValue} b∆∞·ªõc!`;
                    showEffect("RAU M√Å!\nNh√¢n ƒë√¥i ƒëi·ªÉm");
                    doubleEffect = false;
                } else {
                    message.textContent = `B·∫°n ƒë√£ tung ƒë∆∞·ª£c ${diceValue}!`;
                }

                dice.textContent = diceValue;
                dice.classList.remove('rolling');
                rollButton.disabled = false;
                isRolling = false;
                movePlayer(diceValue);
            }, 1000);
        }

        // Di chuy·ªÉn ng∆∞·ªùi ch∆°i
        function movePlayer(stepsToMove) {
            document.getElementById('steps').textContent = stepsToMove;
            let newPosition = playerPosition + stepsToMove;

            if (!hasVisited36 && playerPosition <= 35 && newPosition >= 35) {
                hasVisited36 = true;
                setTimeout(showWheel, 500);
            }

            if (newPosition >= 99 && !stormEffect) {
                stormEffect = true;
                document.getElementById('message').textContent = "B√£o Xu√¢n Quang ƒë√£ ƒë·∫øn! M·ªçi ƒëi·ªÉm x√∫c x·∫Øc nh·∫≠n ƒë∆∞·ª£c s·∫Ω gi·∫£m 1/2.";
            }

            if (newPosition >= TOTAL_CELLS - 1) {
                newPosition = TOTAL_CELLS - 1;
                setTimeout(showVictory, 1000);
            }

            playerPosition = newPosition;
            updatePlayerPosition();
            setTimeout(checkSpecialCell, 100);
        }

        // Ki·ªÉm tra √¥ ƒë·∫∑c bi·ªát
        function checkSpecialCell() {
            const message = document.getElementById('message');
            const originalState = cellOriginalState.get(playerPosition);
            if (!originalState) return;

            if (originalState.classes.includes('railroad')) {
                if (nemChuaCount > 0) {
                    nemChuaCount--;
                    document.getElementById('nem-chua-count').textContent = nemChuaCount;
                    message.textContent = "B·∫°n ƒë√£ s·ª≠ d·ª•ng m·ªôt nem chua ƒë·ªÉ mi·ªÖn nhi·ªÖm v·ªõi ƒë∆∞·ªùng t√†u!";
                    showEffect("S·ª¨ D·ª§NG NEM CHUA!\nMi·ªÖn nhi·ªÖm ƒë∆∞·ªùng t√†u");
                } else {
                    let nearestRailroad = 0;
                    for (let i = playerPosition - 1; i >= 0; i--) {
                        if (cellOriginalState.has(i) && cellOriginalState.get(i).classes.includes('railroad')) {
                            nearestRailroad = i;
                            break;
                        }
                    }
                    playerPosition = nearestRailroad;
                    updatePlayerPosition();
                    message.textContent = `√îi kh√¥ng! B·∫°n v·∫•p ph·∫£i ƒë∆∞·ªùng t√†u v√† ph·∫£i quay l·∫°i √¥ ${playerPosition + 1}!`;
                    showEffect("ƒê∆Ø·ªúNG T√ÄU!\nQuay l·∫°i ƒë∆∞·ªùng t√†u g·∫ßn nh·∫•t");
                }
            }

            if (originalState.classes.includes('nem-chua') && nemChuaCount < 1) {
                nemChuaCount = 1;
                document.getElementById('nem-chua-count').textContent = nemChuaCount;
                message.textContent = "Tuy·ªát v·ªùi! B·∫°n nh·∫≠n ƒë∆∞·ª£c m·ªôt nem chua!";
                showEffect("NH·∫¨N NEM CHUA!\nB·∫£o v·ªá kh·ªèi ƒë∆∞·ªùng t√†u");
            }

            if (originalState.classes.includes('shoes')) {
                shoesEffect = true;
                document.getElementById('shoes-effect').textContent = 'C√≥';
                message.textContent = "√îi kh√¥ng! B·∫°n b·ªã m·∫•t gi√†y!";
                showEffect("M·∫§T GI√ÄY!\nGi·∫£m m·ªôt n·ª≠a ƒëi·ªÉm");
            }

            if (originalState.classes.includes('rau-ma')) {
                doubleEffect = true;
                message.textContent = "Tuy·ªát v·ªùi! B·∫°n nh·∫≠n ƒë∆∞·ª£c rau m√° v√† ƒë∆∞·ª£c x2 ƒëi·ªÉm!";
                showEffect("NH·∫¨N RAU M√Å!\nNh√¢n ƒë√¥i ƒëi·ªÉm");
            }

            if (originalState.classes.includes('dinh-nam')) {
                dinhNamEffect = true;
                document.getElementById('shoes-effect').textContent = 'C√≥';
                message.textContent = "B·∫°n ƒë√£ ch·∫°m ch√°n m·ªôt t√™n ƒêinh N·∫°m!";
                showEffect("G·∫∂P ƒêINH N·∫†M!\nCh·ªâ ƒë∆∞·ª£c 1 ƒëi·ªÉm");
            }

            // X·ª≠ l√Ω √¥ th·ªß ƒë√¥ (29, 30)
            if ((playerPosition === 28 || playerPosition === 29) && nemChuaCount > 0) {
                nemChuaCount--;
                document.getElementById('nem-chua-count').textContent = nemChuaCount;
                message.textContent = "B·∫°n ƒë√£ b·ªã c∆∞·ªõp m·∫•t m·ªôt nem chua ·ªü th·ªß ƒë√¥!";
                showEffect("TH·ª¶ ƒê√î!\nM·∫•t m·ªôt nem chua");
            }

            // X·ª≠ l√Ω √¥ ƒë·∫©y l√πi
            if (originalState.classes.includes('push-back')) {
                const stepsBack = Math.floor(Math.random() * 6) + 1;
                playerPosition = Math.max(0, playerPosition - stepsBack);
                updatePlayerPosition();
                message.textContent = `√îi kh√¥ng! B·∫°n b·ªã ƒë·∫©y l√πi ${stepsBack} b∆∞·ªõc!`;
                showEffect(`B·ªä ƒê·∫®Y L√ôI!\nL√πi ${stepsBack} b∆∞·ªõc`);
            }

            round++;
            document.getElementById('round').textContent = round;
        }

        // Hi·ªÉn th·ªã v√≤ng quay cho √¥ 36
        function showWheel() {
            const wheelOverlay = document.getElementById('wheel-overlay');
            const wheel = document.getElementById('wheel');
            const wheelResult = document.getElementById('wheel-result');
            wheelOverlay.style.display = 'flex';
            wheelResult.textContent = '';
            const spinDegrees = 1080 + Math.floor(Math.random() * 360);
            wheel.style.transform = `rotate(${spinDegrees}deg)`;

            setTimeout(() => {
                const normalizedDegrees = spinDegrees % 360;
                let result = '';
                
                // 3 hi·ªáu ·ª©ng: gi·∫£m 1/2, nh√¢n 2, nh√¢n 3
                if (normalizedDegrees < 120) {
                    result = 'Gi·∫£m m·ªôt n·ª≠a ƒëi·ªÉm';
                    shoesEffect = true;
                    document.getElementById('shoes-effect').textContent = 'C√≥';
                    showEffect("√î 36!\nGi·∫£m m·ªôt n·ª≠a ƒëi·ªÉm");
                } else if (normalizedDegrees < 240) {
                    result = 'Nh√¢n ƒë√¥i ƒëi·ªÉm';
                    doubleEffect = true;
                    showEffect("√î 36!\nNh√¢n ƒë√¥i ƒëi·ªÉm");
                } else {
                    result = 'Nh√¢n ba ƒëi·ªÉm';
                    // T·∫°o hi·ªáu ·ª©ng nh√¢n ba
                    tripleEffect = true;
                    showEffect("√î 36!\nNh√¢n ba ƒëi·ªÉm");
                }
                
                wheelResult.textContent = `K·∫øt qu·∫£: ${result}`;
            }, 3000);
        }

        // ƒê√≥ng v√≤ng quay
        function closeWheel() {
            document.getElementById('wheel-overlay').style.display = 'none';
        }

        // Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n
        function showTutorial() {
            document.getElementById('tutorial-overlay').style.display = 'flex';
        }

        // ƒê√≥ng h∆∞·ªõng d·∫´n
        function closeTutorial() {
            document.getElementById('tutorial-overlay').style.display = 'none';
            document.getElementById('roll-button').textContent = 'Tung x√∫c x·∫Øc';
            gameStarted = true;
        }

        // Hi·ªÉn th·ªã m√†n h√¨nh chi·∫øn th·∫Øng
        function showVictory() {
            document.getElementById('victory-overlay').style.display = 'flex';
            document.getElementById('roll-button').disabled = true;
        }

        // Reset tr√≤ ch∆°i
        function resetGame() {
            playerPosition = 0;
            nemChuaCount = 0;
            shoesEffect = false;
            dinhNamEffect = false;
            doubleEffect = false;
            stormEffect = false;
            round = 1;
            hasVisited36 = false;
            hasVisitedThuDo = false;
            gameStarted = true;
            document.getElementById('nem-chua-count').textContent = nemChuaCount;
            document.getElementById('shoes-effect').textContent = 'Kh√¥ng';
            document.getElementById('player-position').textContent = playerPosition + 1;
            document.getElementById('steps').textContent = 0;
            document.getElementById('round').textContent = round;
            document.getElementById('message').textContent = 'Tr√≤ ch∆°i ƒë√£ ƒë∆∞·ª£c reset!';
            document.getElementById('victory-overlay').style.display = 'none';
            document.getElementById('roll-button').disabled = false;
            document.getElementById('roll-button').textContent = 'Tung x√∫c x·∫Øc';
            createBoard();
        }

        // PWA - C√†i ƒë·∫∑t ·ª©ng d·ª•ng
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-btn').style.display = 'block';
        });

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('install-btn').style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        // Kh·ªüi t·∫°o tr√≤ ch∆°i
        function initGame() {
            createBoard();
            document.getElementById('roll-button').addEventListener('click', rollDice);
            document.getElementById('dice').addEventListener('click', rollDice);
            
            // Th√™m hi·ªáu ·ª©ng cho c√°c n√∫t
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'translateY(2px)';
                    this.style.boxShadow = '0 1px 3px rgba(0,0,0,0.2)';
                });
                
                button.addEventListener('touchend', function() {
                    this.style.transform = '';
                    this.style.boxShadow = '';
                });
            });
            
            // Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n khi b·∫Øt ƒë·∫ßu
            setTimeout(showTutorial, 500);
        }

        // Ch·∫°y game khi trang ƒë√£ t·∫£i xong
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
